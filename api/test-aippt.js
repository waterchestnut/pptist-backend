/**
 * @fileOverview aippt临时验证功能
 * @author xianyang
 * @module
 */

import './init.js'
import {execConsoleFun, genOnePPT, packagePPT} from './services/console-mock/aippt.js'
import {genAgentTaskForPPT, genPPT} from './services/core/llm.js'
import {triggerAgentTask} from './grpc/clients/agentController.js'
import {extractorTmplPrompts} from './services/core/tmpl.js'

/*let ret = await extractorTmplPrompts('pro_1')
console.log(JSON.stringify(ret, null, 2))*/

let example = await extractorTmplPrompts('pro_1')

const syllabus = `# 餐饮市场调查与研究
## 市场概况分析
### 行业发展现状
- 中国餐饮市场规模持续增长，2023年突破5万亿元人民币
- 线上线下融合加速，外卖与堂食并重成为主流模式
- 消费升级推动高端餐饮与特色餐饮快速发展
- 新茶饮、预制菜、小吃快餐等细分赛道表现亮眼
- 区域餐饮品牌崛起，地方特色美食全国化扩张明显

### 市场驱动因素
- 居民可支配收入提升带动消费意愿增强
- 年轻群体成为主力消费者，偏好多样化与体验感
- 数字化技术普及促进运营效率提升
- 城市化进程加快催生更多外食需求
- 国家政策支持餐饮业规范化与创新发展

## 消费者行为研究
### 消费人群画像
- Z世代（18-26岁）占比超40%，注重颜值与社交属性
- 新中产阶层追求品质生活，愿意为优质食材买单
- 家庭用户关注健康营养与用餐安全性
- 上班族偏好便捷高效、价格适中的工作餐
- 外地游客倾向尝试本地特色美食

### 消费决策因素
- 口味满意度是首要选择标准
- 价格合理性影响复购率
- 品牌知名度和口碑评价具有引导作用
- 门店环境与服务体验日益重要
- 外卖平台评分与用户评论直接影响下单决策
- 是否具备网红属性或打卡价值

## 竞争格局分析
### 主要竞争者类型
- 连锁餐饮巨头：如海底捞、百胜中国、星巴克等
- 区域强势品牌：如老乡鸡、巴奴毛肚火锅等
- 网红餐饮品牌：凭借社交媒体迅速走红的新锐品牌
- 个体经营餐厅：数量庞大，灵活应变但抗风险能力弱
- 外资餐饮企业：在高端市场仍具影响力

### 市场集中度与趋势
- 整体市场集中度较低，CR10不足10%
- 连锁化率逐年上升，已达约20%
- 品牌化、标准化成为头部企业核心竞争力
- 跨界入局者增多（如便利店+轻餐、书店+咖啡）
- 并购整合初现端倪，行业洗牌加速

## 细分市场洞察
### 快餐与小吃市场
- 占据最大市场份额，满足高频刚需
- 米粉面饭类单品受欢迎程度高
- 地方特色小吃连锁化潜力巨大
- 自动化设备应用降低人力成本
- 外卖占比普遍超过60%

### 新茶饮市场
- 市场规模突破3000亿元，增速领先
- 喜茶、奈雪的茶引领高端路线
- 蜜雪冰城以性价比打开下沉市场
- 产品创新周期缩短至1-2个月
- 会员体系与私域流量运营成熟

### 高端正餐市场
- 受经济波动影响较大，消费趋于理性
- 强调食材溯源与烹饪技艺
- 场景化消费兴起（商务宴请、纪念日等）
- 主厨IP化趋势明显
- 数字化预订与个性化服务成标配

## 数字化转型趋势
### 数据驱动运营
- POS系统集成客户管理与库存分析功能
- 利用大数据进行菜品销量预测与优化
- 动态定价策略应用于不同时段与区域
- 用户画像用于精准营销推送
- 外卖平台数据反哺门店选址决策

### 智慧餐厅实践
- 自助点餐机与扫码点单普及率超70%
- 中央厨房+冷链配送保障出品一致性
- AI推荐算法提升菜单匹配度
- 机器人送餐在部分场景试点应用
- 物联网设备监控后厨安全与能耗

## 供应链与成本结构
### 供应链体系构成
- 原材料采购占总成本30%-40%
- 冷链物流覆盖范围决定扩张半径
- 中央厨房实现规模化生产降本
- 第三方供应与自建体系各有优劣
- 季节性食材需提前规划储备

### 成本控制关键点
- 租金占比通常达15%-25%，选址至关重要
- 人力成本持续上涨，人员流动性大
- 水电气等能源支出不容忽视
- 包装材料环保要求提高带来成本压力
- 通过集采与长期合作压降采购单价

## 发展机遇与挑战
### 核心发展机遇
- 下沉市场存在巨大空白空间
- 预制菜B端+C端双轮驱动增长
- 国潮文化赋能传统餐饮复兴
- 出海布局成为头部品牌新方向
- 技术革新带来全链条效率提升

### 面临的主要挑战
- 同质化竞争严重，创新难度加大
- 食品安全事件频发影响行业信誉
- 法规监管趋严增加合规成本
- 经济不确定性抑制高端消费
- 人才短缺制约管理水平提升`

const pptSysPrompt = `
    ## 定位
    - 角色：PPT制作专家
    - 任务：根据输入的PPT大纲，按照给定的风格和语言，进一步扩展和充实内容，生成结构化的PPT数据；如果用户提供了详细材料，扩展和充实内容时优先使用用户提供的详细材料
    
    ## 输出要求
    - PPT中包含以下类型的页面：
      - 封面页（cover），选择示例中类型为cover的页面，套用格式和要求生成内容
      - 目录页（contents），选择示例中类型为contents的页面，套用格式和要求生成内容
      - 过渡页（transition），选择示例中类型为transition的页面，套用格式和要求生成内容
      - 内容页（content），选择示例中类型为content的页面，套用格式和要求生成内容
      - 结束页（end），选择示例中类型为end的页面，套用格式和要求生成内容
    - 页面中的页面插图（pageFigure）和背景图（background），根据本页的PPT内容推荐pexels网站的英文检索词
    - 页面中的项目插图（itemFigure），根据本组列表项目和列表项目标题推荐推荐pexels网站的英文检索词
    - 为保证PPT展示效果，生成的items数组的大小请严格保持和使用样例模版的items数组的大小一致
    - id、groupId保持选择的样例中该字段的值不变
    - 请注意，示例中的字段名是大小写敏感的，输出时保持大小写敏感
    - 一份完整的PPT数据应该包括1个封面页、1个目录页、多个过渡页、多个内容页、1个结束页，总页数在10~30页区间
    - 请严格遵守上述文本字数要求
    
    ## 风格分类：根据选择的风格，要求输出内容的语气/表达风格参考以下定义
    #### 学术风
    - 核心：客观、严谨、专业、数据驱动
    - 典型句式：“实验结果表明…”
    #### 职场风
    - 核心：简洁、决策导向、高效传递信息
    - 典型句式：“建议采取以下三项措施…”
    #### 教育风
    - 核心：易懂、互动、分层、引导
    - 典型句式：“第一步：观察现象…”
    #### 营销风
    - 核心：夸张、吸引、情感化、行动号召
    - 典型句式：“立即抢购，立省1000元！”
    #### 通用
    - 核心：中性、普适、清晰
`

const pptExamplePromptJson = `
## 输出样例（参考输出样例直接返回JSON格式的数据，无需\`\`\`json等额外解释）：
${JSON.stringify(example, null, 2)}
`
const content = await genPPT(syllabus, {pptSysPrompt, examplePrompt: pptExamplePromptJson, stream: false})

console.log(content)
